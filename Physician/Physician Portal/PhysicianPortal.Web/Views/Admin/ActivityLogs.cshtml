@using Kendo.Mvc.UI
@model PhysicianPortal.Web.Models.ActivityLogReportViewModel
@{
    ViewBag.Title = "Activity Logs";
}


<fieldset>
    <legend>Activity Logs</legend>


    
    @(Html.Kendo().Grid<PhysicianPortal.Core.Data.vwAuditTrail>()
    .Name("gridAuditLogList")
    .HtmlAttributes(new { @style = "display:inline-block; width: 100%" })
    .Columns(columns =>
    {
        columns.Bound(c => c.LogMessage).Title("Message");
        columns.Bound(c => c.Data).Title("Data");
        columns.Bound(c => c.Url).Title("Page URL");
        columns.Bound(c => c.FullName).Title("User");
        columns.Bound(c => c.AuditStamp).Title("Audit Stamp").Format("{0:MM/dd/yyyy, hh:mm:ss tt}").Width(160).Filterable(false);
        columns.Bound(c => c.Device).Title("Device");
    })
     .ToolBar(tools => tools.Excel())
                    .Excel(excel => excel
                        .FileName("Activity Log.xlsx")
                        .Filterable(true)
                        .AllPages(true)
                    )
    //.ToolBar(tools => tools.Pdf())
    //   .Pdf(pdf => pdf
    //       .AllPages()
    //       .AvoidLinks()
    //       .PaperSize("A4")
    //       .Scale(0.8)
    //       .Margin("2cm", "1cm", "1cm", "1cm")
    //       //.Landscape()
    //       .RepeatHeaders()
    //       .TemplateId("page-template")
    //       .FileName("Kendo UI Grid Export.pdf")
    //   //.ProxyURL(Url.Action("Pdf_Export_Save", "Admin"))
    //   )
    .Filterable(ftb => ftb
            .Mode(GridFilterMode.Row)
            .Extra(true)
            .Operators(o => o
            .ForString(s => s
                .Clear()
                .Contains("Contains")
            )
        )
    )
    .Sortable()
    .Pageable(pageable => pageable
        .Refresh(true)
        .PageSizes(true)
        )
    .DataSource(dataSource => dataSource
        .Ajax()
        .Read(read => read.Action("GetAuditTrail", "Admin"))
        .PageSize(10)
        .Sort(sort => sort.Add("AuditStamp").Descending())
    )
    .NoRecords(n => n.Template("No records to display"))
    )
</fieldset>

<div id="showPDFFormsListKendoWindow" style="display: none;">
    <div id="divDocumentViewer" style="text-align: center; width: 100%; height: 100%;"></div>
</div>

<script>
    $(document).ready(function () {
        $(".k-dropdown-operator").hide();
    });

    

    function exportPdf() {
        $.ajax({
            type: "POST",
            url: '@Url.Action("ExportToPdf", "Admin")',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            beforeSend: function () {
                $("#loading-image").show();
            },
            success: function (msg) {
                var data;
                if (msg.hasOwnProperty("d")) {
                    data = msg.d;
                }
                else
                    data = msg;

                if (data.success) {
                    //$.notifyBar({ html: data.message, cssClass: 'success', position: 'top' });
                    //success_check = true

                    //$("#window").data("kendoWindow").close();
                    //$.notifyBar({ html: data.message, cssClass: "success", position: "top" });
                    //$("#gridRefill").data("kendoGrid").dataSource.read();
                    //$("#gridSentRefill").data("kendoGrid").dataSource.read();
                    //$("#txtNote").val("");
                }
                else {
                    alert("Error: " + data.message);
                }
            },
        });
    }
</script>

<script type="x/kendo-template" id="page-template">
    <div class="page-template">
        <div class="header">
            <div style="float: right">Page #: pageNum # of #: totalPages #</div>
            Multi-page grid with automatic page breaking
        </div>
        <div class="watermark">KENDO UI</div>
        <div class="footer">
            Page #: pageNum # of #: totalPages #
        </div>
    </div>
</script>

<style>
    /* Page Template for the exported PDF */
    .page-template {
        font-family: "DejaVu Sans", "Arial", sans-serif;
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
    }

        .page-template .header {
            position: absolute;
            top: 30px;
            left: 30px;
            right: 30px;
            border-bottom: 1px solid #888;
            color: #888;
        }

        .page-template .footer {
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: 30px;
            border-top: 1px solid #888;
            text-align: center;
            color: #888;
        }

        .page-template .watermark {
            font-weight: bold;
            font-size: 400%;
            text-align: center;
            margin-top: 30%;
            color: #aaaaaa;
            opacity: 0.1;
            transform: rotate(-35deg) scale(1.7, 1.5);
        }

    /* Content styling */
    .customer-photo {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background-size: 32px 35px;
        background-position: center center;
        vertical-align: middle;
        line-height: 32px;
        box-shadow: inset 0 0 1px #999, inset 0 0 10px rgba(0,0,0,.2);
        margin-left: 5px;
    }

    .customer-name {
        display: inline-block;
        vertical-align: middle;
        line-height: 32px;
        padding-left: 3px;
    }
</style>